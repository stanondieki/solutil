[config]
SCM_DO_BUILD_DURING_DEPLOYMENT=true
echo "📦 Installing production dependencies..."
npm ci --only=production

# Create necessary directories
echo "📁 Creating required directories..."
mkdir -p logs
mkdir -p uploads/documents
chmod 755 uploads/documents

# Set up logging
echo "📋 Setting up logging..."
touch logs/combined.log
touch logs/error.log

# Run health check
echo "🏥 Running health check..."
npm run test || echo "⚠️ Tests failed, but continuing deployment..."

# Clean up development files
echo "🧹 Cleaning up development files..."
rm -rf node_modules/.cache
rm -rf *.log

echo "✅ Azure deployment completed successfully!"
echo "🌐 Your backend should be available at: https://your-app-name.azurewebsites.net"